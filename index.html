<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>JHipster Meetup Presentation</title>

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css" id="theme">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

		<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet" type="text/css">
		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
			<div class="slides">
				<section data-background="#3E8ACC" data-transition="none" data-background-transition="none">
					<img src="img/wallpaper.png" style="border:none;box-shadow:none"/>
					<div style="font-family:Pacifico;font-size:150%;" class="fragment fade-out">Greetings, Java Hipster!</div>
					<!--<div style="font-family:Pacifico;font-size:150%" class="fragment fade-in" data-fragment-index=0>Greetings, Java Microservice Hipster!</div>-->
				</section>
				<section data-background="#3E8ACC" data-transition="none" data-background-transition="none">
					<img src="img/wallpaper.png" style="border:none;box-shadow:none"/>
					<div style="font-family:Pacifico;font-size:150%">Greetings, Java Microservice Hipster!</div>
				</section>
                <section>
					<br/><br/>
					<h2>Who are we ?</h2>
    				<div style="float:left">
    					<img src="img/1577727.jpeg" width="150"/>
    					<h3>William Marques</h3>
                        <p><a href="http://twitter.com/wylmarq"><i class="fa fa-twitter"></i>
@wylmarq</a></p>
                        <p><a href="mailto:wmarques@ippon.fr">wmarques@ippon.fr</a></p>
    					<p>JHipster Intern</p>

    				</div>
    				<div style="float:right">
    					<img src="img/513471.jpeg" width="150"/>
    					<h3>Pierre Besson</h3>
    					<p><a href="http://twitter.com/pibesson"><i class="fa fa-twitter"></i>
@pibesson</a></p>
                        <p><a href="mailto:pbesson@ippon.fr">pbesson@ippon.fr</a></p>
    					<p>JHipster Intern</p>
    				</div>

				</section>

                <section>
                    <h1>Summary</h1>
                    <ol style="font-size:150%">
                        <li>One <span class="fragment highlight-blue">Docker Compose</span> to run them all</li>
                        <li>Monitoring with <span class="fragment highlight-red">JHipster Console</span></li>
                        <li>JHipster Microservices <span class="fragment highlight-green">Configuration</span></li>
                    </ol>
                </section>
				<section data-markdown>
						<script type="text/template">
							### JHipster Microservice <i class="fa fa-sitemap"></i>

							<img src="img/microservices_architecture_compose.png" style="margin:0px;border:none;box-shadow:none" width="70%"/>
							<h4 > Part 1: One <span style="color:#2980b9">Docker Compose</span> to run them all </h4>
						</script>
					</section>
				<section>
					<h4>Microservices, Gateway, Registry, Dashboards ...</h4>
					<h3><i class="fa fa-sitemap"></i> + <i class="fa fa-book"></i> + <i class="fa fa-tachometer"></i></h3>
					<h2>How do I run all these apps ?</h2>
					<h1><i class="fa fa-puzzle-piece"></i></h1>
				</section>

				<section>
					<h2>yo jhipster:docker-compose</h2>
					<p>
						A <strong>JHipster</strong> subgenerator.
					</p>
                    <p>
                        <img height="30%" width="30%" data-src="img/docker-compose.png" alt="" />
                    </p>

				</section>

                <section>
                    <section>
                        <h2>What does it do ?</h2>

                    </section>
                    <section>
                        <p>
                            Get all the necessary files into <strong class="fragment grow highlight-red">ONE</strong> docker-compose YAML
                        </p>
                        <p>
                            So you can easily run all the necessary container :
                            <ul>
                                <li class="fragment">Applications</li>
                                <li class="fragment">Databases</li>
                                <li class="fragment">Registry</li>
                                <li class="fragment">Monitoring</li>
                            </ul>
                        </p>

                    </section>
                </section>

				<section>
                    <section data-background="img/pug-head-tilt-o.gif">
                        <div style="background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 30px;">
                            <h2 style="color:white; margin:0">How does it works ?</h2>
                        </div>
                    </section>

                    <section>
                        Let's begin with this setup:
                        <img style="padding:30px" data-src="img/exUML.png" alt="" />
                    </section>

                    <section>
                        <p>
                            To run all this without the subgenerator, we would need to :
                            <ul>
                                <li>Launch each container one by one</li>
                                <li>Create a shared config file (to share the JWT token)</li>
                                <li>Launch the registry container</li>
                            </ul>
                        </p>
                        <p>
                            <strong>â‰ˆ5</strong> terminal tabs and <strong>alot</strong> of time...
                        </p>
                        <img  data-src="img/sadcat.gif" alt="" />

                    </section>

                    <section>
                        <p>Let's go inside a directory aside of our apps and run</p>
                        <pre><code data-trim class="sh">
cd docker-config
yo jhipster:docker-compose
                        </code></pre>
                    </section>

                    <section>
                        <h2>Let's run everything with one command</h2>
                        <pre><code data-trim class="sh">
                        docker-compose up -d
                        </code></pre>
                        <img  data-src="img/kanye.gif" alt="" />
                    </section>

                    <section>
                        <h2>What do we have here ?</h2>
                        <p>Here is the (simplified) generated docker-compose file:</p>
                        <pre><code data-trim>
version: '2'
services:

    jhipster-registry:
        extends:
          file: jhipster-registry.yml
          service: jhipster-registry

    accountsmicroservice-app:
        image: accountsmicroservice
        external_links:
            - accountsmicroservice-mysql:mysql
            - jhipster-registry:registry
    accountsmicroservice-mysql:
        container_name: accountsmicroservice-mysql
        image: mysql:5.7.11


    hipsterbankgateway-app:
        image: hipsterbankgateway
        external_links:
            - hipsterbankgateway-mysql:mysql
            - jhipster-registry:registry
        ports:
            - 8080:8080
    hipsterbankgateway-mysql:
        container_name: hipsterbankgateway-mysql
        image: mysql:5.7.11

    insurances-app:
        image: insurances
        external_links:
            - insurances-mongodb:mongodb
            - jhipster-registry:registry

    insurances-mongodb:
        container_name: insurances-mongodb
        image: mongo:3.2.3
                        </code></pre>
                    </section>
				</section>

                <section>
                    <section data-background="img/scale.gif">
                        <div style="background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px;">
                            <h2 style="color:white; margin:0">Want to scale ?</h2>
                        </div>
                    </section>
                    <section>
                        <h2>How to scale a microservice</h2>
                        <pre><code data-trim class="sh">
                            docker-compose scale accountsmicroservice-app=2
                        </code></pre>
                        <br>
                        <h3>
                            What's Happening ?
                        </h3>
                        <ul>
                            <li>Instances see each other, thanks to Eureka</li>
                            <li>The gateway load balance between each instances</li>
                            <li>Cache replication with HazelCast (for SQL databases)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>How to scale a database</h2>
                        <p>
                            Only available with Cassandra and MongoDB databases.
                        </p>
                        <p>
                            We are going to scale our MongoDB database:
                            <img style="border:none;"  src="img/mongoreplica.jpg" alt="">
                        </p>
                        <p style="text-align: right; font-size: 0.6em;">
                            <i>Picture from wayneye.com</i>
                        </p>
                    </section>

                </section>

	<section data-markdown>
			<script type="text/template">
				### JHipster Microservice <i class="fa fa-sitemap"></i>

				<img src="img/microservices_architecture_monitoring.png" style="margin:0px;border:none;box-shadow:none" width="70%"/>
				<h4 > Part 2: Monitoring with <span style="color:red">JHipster Console</span></h4>
			</script>
		</section>
	<section>
		<section data-markdown>
			<script type="text/template">
				### Monitoring a JHipster microservice cluster
				##<i class="fa fa-line-chart"></i>
				<span style="float:left">What do we want to do ?</span>
				* Centralize and analyse all your apps logs and metrics
				* Be able to index and search monitoring information
				* Display metrics in real time, interactive graphs
				* Receive alerts <!--refine the selection -->
			</script>
		</section>
		<section data-markdown>
			<!--
			The ELK stack is composed of:

			Elasticsearch for indexing the data (logs and metrics)
			Logstash to manage and process the logs received from the applications
			Kibana to visualize the logs with a nice interface
			-->
			<script type="text/template">
			<img data-src="img/console.svg" alt="" style="border:none" width="40%"/>

			<div class="fragment">Monitoring and Alerting tool based on the ELK stack
				<img data-src="img/elk-logo.png" alt="" style="border:none" width="45%"/>
				<img data-src="img/docker+metrics.png" alt="" style="border:none" width="23%"/>
			</div>

			<ul>
    			<li class="fragment">Monitor logs and metrics of your monolith and microservice apps</li>
    			<li class="fragment">Define alerting rules to be notified when anolies are detected (provided by the **Elastalert** tool from Yelp)</li>
    			<li class="fragment">Can be customized and extended to suit your needs</li>
            </ul>
			</script>
		</section>
		<section data-markdown>
			<script type="text/template">
				### Getting started with JHipster monitoring
Forward logs and metrics to logstash

```
jhipster:
	logging:
		logstash:
			enabled: true
			host: localhost
	metrics:
		logs:
		    enabled: true
		    reportFrequency: 60 # seconds
```
Get the compose file and start **JHipster-Console**, **Elasticsearch** and **Logstash**:
<!--
curl -o conf/logstash.conf https://raw.githubusercontent.com/jhipster/jhipster-console/master/log-monitoring/log-config/logstash.conf
curl -o docker-compose.yml https://raw.githubusercontent.com/jhipster/jhipster-console/master/boostrap/docker-compose.yml
-->
```
docker-compose up -d
```
			</script>
		</section>
		<section data-markdown>
			<script type="text/template">
			  # DEMO
			  ### MICROSERVICE MONITORING
			  ### WITH
			  ### <span style="color:#2196f3">JHIPSTER CONSOLE</span>

			</script>
		</section>
	</section>
	<section data-markdown>
			<script type="text/template">
				### JHipster Microservice <i class="fa fa-sitemap"></i>

				<img src="img/microservices_architecture_config_server.png" style="margin:0px;border:none;box-shadow:none" width="70%"/>
				<h4> Part 3: JHipster microservices <span style="color:green">configuration</span></h4>
			</script>
		</section>
<section>
	<section data-markdown>
		<script type="text/template">
			### Centralized Configuration with JHipster and Spring Cloud Config
			<p><i class="fa fa-leaf"></i> + <i class="fa fa-cloud"></i> + <i class="fa fa-cogs"></i></p>
			<ul>
                <li> Manage all your services configuration in a single place</li>
    			<li> Define configurations for specific profiles (dev, prod)</li>
    			<li> Put the configuration under version control</li>
    			<li> Bonus: refresh configuration without restarting the app</li>
            </ul>
		</script>
	</section>
	<section data-markdown>
		<script type="text/template">
			### How does it works ?
			<ul>
                <li class="fragment"> On startup, applications query the **configuration server** and overwrite local properties with the remote ones</li></span>
    			<li class="fragment" style=" margin: 20px 0;"> Properties are regular Spring Boot properties:
    				<ul>
        				<li> Typed, _key-value_ format (.properties, .yml)</li>
        				<li> Defined in **@ConfigurationProperties** classes</li>
        				<li> Properties can be profile specific </li><!--application.yml, application-dev.yml replaced extended  -->
        				<li> Several profiles can be used at the same time</li>
                    </ul>
    			</li>
            </ul>
		</script>
	</section>

	<section data-markdown>
		<script type="text/template">
		### Using the Configuration Server
		<div style="font-size:95%" class="fragment">
		How do I define externalized properties for my services ?
		<div><i class="fa fa-arrow-right"></i> Simply add regular property files in your configuration source</div>
		</div>
	<div class="fragment" style="margin:30px">
		<h3> Configurations sources</h3>
		<div style="text-align:left">
		<ul><li> <i class="fa fa-file-text-o"></i> File based  (for development)</li>
		<li> <i class="fa fa-code-fork"></i> Git based (for production)</li>
	<p><i class="fa fa-arrow-circle-right"></i> Load from a git repo (_file://_, _https://_ or _ssh://_)</p>
	<p><i class="fa fa-arrow-circle-right"></i> Tag the config (using _branches_ or _commit ids_)</p>
	</ul>
		</div>
	</script>
	</section>

	<section data-markdown>
		<script type="text/template">
		  # DEMO
		### CENTRALIZED CONFIGURATION
		### WITH
		### SPRING CLOUD CONFIG SERVER
		<!-- config server demo, sample property with a rest controller, dev, prod, hot refresh -->
	</script>
	</section>
</section>

<section>
	<section data-markdown data-transition="none">
		<script type="text/template" >
	### Feature Toggling <i class="fa fa-toggle-off"></i>
	### with JHipster microservices
		</script>
	</section>
	<section data-markdown data-transition="none">
		<script type="text/template">
	### Feature Toggling <i class="fa fa-toggle-on"></i>
	### with JHipster microservices
		</script>
	</section>
	<section data-markdown >
		<script type="text/template">
	### Feature Toggling <i class="fa fa-toggle-on"></i>
	### with JHipster microservices
	* **Goal:** Safely add or replace a feature with no downtime
	* **Problem:** Our architecture is distributed !<!-- so it's not just a matter of wrapping new code in a big "if"-->

	<blockquote style="width:100%">
		<p style="float:left"> Feature toggling can be used for:</p>
	<ul><li> **Canary releasing:** turn the new feature for _N%_ of users</li>
	<li> **A/B testing:**  turn on the feature for a control group and study their behavior</li>
	</ul>
	</blockquote>
		<!-- feature toggling demo, refreshing zuul routing -->
	</script>
	<aside>
		* Safely replace an existing functionality with no downtime
		* have several version of the same feature available at the same time
	</aside>
	</section>

	<section>
	  <h3>What we are going to do ?</h3>
	  <div style="font-size:90%;text-align:left">
<div class="fragment">
	    <p>On the <b>back-end</b>:
	    <ul>
	    <li> Deploy <b>account-v2</b> a new (and better) account microservice that introduce breaking changes</li>
	    <li> On the gateway, edit routes to redirect API calls to <b>account-v2</b></li>
	    </ul></p>
</div>
<div class="fragment">
	    <p>On the <b>front-end</b>:
	    <ul>
	      <li> Switch a toggle to display the new UI</li>
	    </ul>
	    </p>
</div>
<div class="fragment">
	    <b>Requirements</b>:
	    <ul style="disc">
	      <li>Back-end and Front-end changes must happen at the same time</li>
	      <li>We are not allowed to restart the gateway</li>
	    </ul>
	</div>
	    </div>
	</section>
	<section data-markdown>
		<script type="text/template">
		  # DEMO
		### FEATURE TOGGLE
		### WITH JHIPSTER MICROSERVICE
	</script>
	</section>
</section>

<!-- too bad, no time for this goodness
<section data-markdown>
  <script type="text/template">
        # DEMO
	### FEATURE TOGGLE
	### WITH
	### <span style="color:#2196f3">SPRING CLOUD CONFIG SERVER</span>
</script>
</section>

</section>
<section>
<section data-markdown>
	<script type="text/template" >
### Applying the Circuit Breaker Pattern
### with
### JHipster microservices
	</script>
</section>

<section data-markdown style="text-align:left;font-size:90%">
	<script type="text/template">
### Circuit Breakers
* Wrap microservice calls in a component that monitor for failures
* Define a failure **threshold** beyond which the circuit will _trip open_
* Once the circuit is opened, calls <span style="color:red">stop</span> being made

**Motivations:**
* Give the microservice time to heal
* Redirect to a fallback
</div>

**Hystrix:**
* Latency and fault tolerance library from Netflix
* Integrated with Ribbon (load balancing)
* Provide fallbacks and monitoring
</script>

<aside>
	- Stop cascading failures in a complex distributed system.
	- Fail fast and rapidly recover.
	- Fallback and gracefully degrade when possible.
	- Enable near real-time monitoring, alerting, and operational control.
</aside>
</section>

<section data-markdown>
	<script type="text/template" >
### Demo

<img src="img/circuit-breakers-architecture.png" width="70%" style="border:none;box-shadow:none"/>

<img src="img/hystrix-dashboard.png" width="60%"/>

<a href="https://github.com/PierreBesson/jhipster-circuit-breaker-demo" style="font-size:80%">https://github.com/PierreBesson/jhipster-circuit-breaker-demo</a>
	</script>
</section>
</section>
-->

<section>
  <h1>Thank You !</h1>
  <img src="img/logo-jhipster2x.png" style="border:none;box-shadow:none"/>
  <div style="float:left">
	  <h3>William Marques</h3>
	  <p><a href="http://twitter.com/wylmarq"><i class="fa fa-twitter"></i>
@wylmarq</a></p>
	  <p><a href="mailto:wmarques@ippon.fr">wmarques@ippon.fr</a></p>

  </div>
  <div style="float:right">
	  <h3>Pierre Besson</h3>
	  <p><a href="http://twitter.com/pibesson"><i class="fa fa-twitter"></i>
@pibesson</a></p>
	  <p><a href="mailto:pbesson@ippon.fr">pbesson@ippon.fr</a></p>
  </div>
</section>
</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                slideNumber:true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>
	</body>
</html>
